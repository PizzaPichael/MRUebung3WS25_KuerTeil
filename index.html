<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kuer Abgabe WiSe 25/26</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/MozillaReality/ammo.js@8bbc0ea/builds/ammo.wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.4/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.1/dist/aframe-extras.min.js"></script>

    <!--The debug UI has been added by copilot-->
    <style>
      #debug-ui {
        position: fixed;
        top: 10px;
        left: 800px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        z-index: 9999;
      }
      #debug-ui button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 3px;
        cursor: pointer;
        margin-right: 10px;
      }
      #debug-ui button:hover {
        background: #45a049;
      }
      #debug-ui label {
        cursor: pointer;
        user-select: none;
      }
      #debug-ui input[type='checkbox'] {
        cursor: pointer;
        margin-left: 5px;
      }
    </style>

    <!--Scripts-->
    <div>
      <!--Custom scripts-->
      <script src="/src/components/custom/teleport-component.js"></script>
      <script src="/src/components/custom/look-at-camera-component.js"></script>
      <script src="/src/components/custom/proximity-detection-by-circle-componente.js"></script>
      <script src="/src/components/custom/camera-position-debug.js"></script>
      <script src="/src/components/custom/camera-persistence.js"></script>
      <script src="/src/components/custom/blink-cursor.js"></script>
      <script src="/src/components/custom/paper-glide-upwards.js"></script>
      <script src="/src/components/custom/spiral-movement.js"></script>
      <script src="/src/components/custom/spawn-text-planes.js"></script>
      <script src="/src/components/custom/hand-grab.js"></script>
      <script src="/src/components/custom/grabbable-custom.js"></script>
      <script src="/src/components/custom/on-event-teleport.js"></script>
      <script src="/src/components/custom/on-event-deactivate-components.js"></script>
      <script src="/src/components/custom/torchlight-spawner.js"></script>
       <!--External scripts-->
      <script src="/src/components/external/aframe-keyboard.min.js"></script>
    </div>
  </head>
  <body>
    
    <!-- Debug UI, written by Copilot -->
    <div id="debug-ui">
      <button id="logCameraBtn">Log Camera Position</button>
      <label>
        <input type="checkbox" id="persistCheckbox" />
        Persist Camera on Reload
      </label>
    </div>

    <script>
      // Button Event Listener, written by Copilot
      document
        .getElementById('logCameraBtn')
        .addEventListener('click', function () {
          const camera = document.querySelector('#head');
          if (camera && camera.components['camera-position-debug']) {
            camera.components['camera-position-debug'].logCurrentState();
          }
        });

      // Checkbox Event Listener, written by Copilot
      document
        .getElementById('persistCheckbox')
        .addEventListener('change', function (e) {
          const camera = document.querySelector('#head');
          if (camera && camera.components['camera-persistence']) {
            camera.setAttribute(
              'camera-persistence',
              'enabled',
              e.target.checked,
            );
          }
        });
    </script>

    <!--Scene-->
    <a-scene id="scene"
      light="defaultLightsEnabled: true"
      stats
      physics=" driver: ammo; debug: true; debugDrawMode: 1;"
      xr-mode-ui="enabled: true; enterVREnabled: true; enterAREnabled: true; XRMode: xr;"
    >
      <!--Asset registration-->
      <a-assets id="asset-registration">
        <!--Asset items-->
        <a-asset-item
          id="throneroom"
          src="/src/models/throneroom/throneroom_project.glb"
        ></a-asset-item>
        <a-asset-item
          id="stairs"
          src="/src/models/broken_stairs__concrete__high_poly/scene.gltf"
        ></a-asset-item>
        <a-asset-item
          id="altar"
          src="/src/models/altar/scene.gltf"
        ></a-asset-item>
        <a-asset-item
          id="lowpoly-altar"
          src="/src/models/altar_lowpoly_concept/scene.gltf"
        ></a-asset-item>
        <a-asset-item
          id="old-paper"
          src="/src/models/old_paper/scene.gltf"
        ></a-asset-item>
        <a-assets-item
          id="computer"
          src="/src/models/old_retro_stylized_computer/scene.gltf"
        ></a-assets-item>
        <a-assets-item
          id="curtain-rod"
          src="/src/models/curtain_rod/scene.gltf"
        ></a-assets-item>
        <a-assets-item
          id="white-curtain"
          src="/src/models/curtain_774/scene.gltf"
        ></a-assets-item>
        <a-assets-item
          id="victorian-curtain"
          src="/src/models/victorian_curtain/scene.gltf"
        ></a-assets-item>
        <a-assets-item
          id="generator"
          src="/src/models/o2_generator/scene.gltf"
        ></a-assets-item>
        <a-assets-item
          id="fence"
          src="/src/models/big_fence/scene_multiple.gltf"
        ></a-assets-item>
        <a-assets-item
          id="socket"
          src="/src/models/europe_wall_socket/scene.gltf"
        ></a-assets-item>
        <a-assets-item
          id="diesel-generator"
          src="/src/models/diesel_generator_low-poly_game_asset/scene.gltf"
        ></a-assets-item>
        <a-assets-item
          id="plug"
          src="/src/models/power_plug_european/scene.gltf"
        ></a-assets-item>
        <a-assets-item
          id="antenna"
          src="/src/models/usb_wifi_adapter__antenna/scene.gltf"
        ></a-assets-item>
        <a-assets-item
          id="antenna-plug"
          src="/src/models/antenna_plug/untitled.gltf"
        ></a-assets-item>

        <!--Textures-->
        <img
          id="computerBaseTexture"
          src="/src/models/old_retro_stylized_computer/textures/Scene_-_Root_baseColor.png"
        />
        <img id="chatgptscreenshot" src="/src/textures/chatjibbedy-logo.png" />
        <img
          id="chatgptuielements"
          src="/src/textures/chat_gpt_text_input_element_with_greeting.png"
        />
        <img
          id="chatgptuielementswithcursor"
          src="/src/textures/chat_gpt_text_input_element_with_greeting_and_linecursor.png"
        />
        <img
          id="chessfloor-diff"
          src="/src/textures/floor_tiles_06_1k/textures/floor_tiles_06_diff_1k.jpg"
        />
        <img
          id="chessfloor-disp"
          src="/src/textures/floor_tiles_06_1k/textures/floor_tiles_06_disp_1k.jpg"
        />
        <img
          id="chessfloor-rough"
          src="/src/textures/floor_tiles_06_1k/textures/floor_tiles_06_rough_1k.jpg"
        />
      </a-assets>

      <!--Entities-->
      <!--Camera Rig and Controller-->
      <a-entity id="cameraRig">
        <a-entity
          id="head"
          camera="active: true"
          look-controls
          wasd-controls="fly: false"
          position="0 1.7 -6"
          rotation="0 0 0"
          camera-position-debug
          camera-persistence
        >
          <a-entity
            id="keyboard"
            position="-0.2 -0.15 -0.5"
            a-keyboard
            visible="false"
          ></a-entity>
          <!-- Mouse input -->
          <a-entity
            id="mouseCursor"
            raycaster="objects: .collidable"
            cursor="rayOrigin: mouse"
          ></a-entity>
        </a-entity>
        <!--starting player pos = "0 1.7 -6"-->
        <a-entity
          id="left-hand"
          meta-touch-controls="hand: left"
          simple-teleport="cameraRig: #cameraRig"
          hand-grab
        ></a-entity>
        <a-entity
          id="right-hand"
          meta-touch-controls="hand: right"
          hand-grab
        ></a-entity>
      </a-entity>

      <!--Teleportation planes-->
      <a-plane id="teleport-ground"
        position="0 0 0"
        rotation="-90 0 0"
        width="50"
        height="50"
        material="opacity: 0; transparent: true"
        visible="false"
        ammo-body="type: static"
        ammo-shape="type: box"
      ></a-plane>

      <!--Throneroom collision box-->
      <a-box id="throneroom-floor-collision"
        position="0 0.01 -25"
        width="160"
        height="0.001"
        depth="240"
        visible="false"
        ammo-body="type: static"
        ammo-shape="type: box"
      ></a-box>

      <a-entity id="vr-entities" 
        hide-on-enter-ar>
        <!--Throneroom object-->
        <a-entity id="throneroomentity"
          gltf-model="#throneroom"
          position="0 0 0"
          scale="4 4 4"
          shadow="receive: true"
          visible="true"
          torchlight-spawner
        ></a-entity>

        <!--Throneroom interior-->
        <a-entity id="throneroom-interior" hide-on-enter-ar>
          <!--Altar Area-->
          <a-entity id="altar" hide-on-enter-ar>
            <a-entity
              id="stairsentitiy"
              gltf-model="#stairs"
              position="0 -1.2 -40"
              scale="0.6 0.6 0.6"
              rotation="0 90 0"
              ammo-body="type: static"
              ammo-shape="type: hull; offset: 6 4.7 0"
              visible="true"
            >
            </a-entity>
            <a-entity
              id="altar-entitiy"
              gltf-model="#altar"
              position="0 6 -50"
              visible="true"
              scale="0.03 0.03 0.03"
              rotation="0 0 0"
              ammo-body="type: static"
              ammo-shape="type: box; offset: 0 3.8 0"
            >
            </a-entity>
          </a-entity>
          <!-- -->

          <!--Interaktionsterminal-->
          <a-entity id="terminal" visible="true" hide-on-enter-ar>
            <a-entity
              id="lowpoly-altar-entitiy"
              gltf-model="#lowpoly-altar"
              position="0 0 -30"
              scale="1 1 1"
              rotation="0 0 0"
              ammo-body="type: static"
              ammo-shape="type: hull"
              visible="true"
            >
            </a-entity>
            <a-entity
              id="old-paper-entitiy"
              gltf-model="#old-paper"
              position="0 1.347 -30"
              rotation="0 90 23.807"
              scale="0.312 0.5 0.309"
              visible="true"
              glide-upwards="enabled: false, speed: 0.01"
              proximity-circle="
                target: #paper-proximity-plane; 
                componentToChange: glide-upwards;
                compAttrToChange: enabled;
                compAttrNewBoolValue: true"
              ammo-body="type: static"
              ammo-shape="type: hull"
            >
              <a-text
                value="Wie kann ich dir heute helfen, die Welt zu verbessern?"
                position="0.08 0.11 -0.97"
                rotation="-90 -90 0"
                width="2"
                wrap-count="46"
                color="black"
                ammo-body="type: static"
                ammo-shape="type: box"
              >
              </a-text>
              <a-plane
                src="#chatgptuielements"
                position="0 0.1 0"
                rotation="-90 -90 0"
                height="0.63"
                width="2.92"
                material="transparent: true; alphaTest: 0.5"
                blink-cursor="non_cursor_src: #chatgptuielements; cursor_src: #chatgptuielementswithcursor"
                ammo-body="type: static"
                ammo-shape="type: box"
              >
              </a-plane>
              <a-entity
              id="termnial-light"
              position="0 1 0"
              light="
                type: point;
                color: #ffb357;
                distance: 2;
                decay: 1"
              >
              </a-entity>
            </a-entity>
            <a-circle
              id="paper-proximity-plane"
              position="0 0.03 -30"
              rotation="-90 0 0"
              radius="5"
              color="black"
              transparent="true"
              opacity="0"
              ammo-body="type: static"
              ammo-shape="type: box"
            ></a-circle>
          </a-entity>

          <!--Altar curtains-->
          <a-entity id="altar-curtains" visible="true" hide-on-enter-ar>
            <a-entity
              id="white-curtain-entity"
              gltf-model="#white-curtain"
              position="1 0 -59"
              rotation="0 0 0"
              scale="0.15 0.3 0.2"
              ammo-body="type: static"
              ammo-shape="type: hull"
              visible="true"
            >
            </a-entity>
            <a-entity
              id="victorian-curtain-entity"
              gltf-model="#victorian-curtain"
              position="9 16 -57"
              rotation="0 0 0"
              scale="4 8 10"
              ammo-body="type: static"
              ammo-shape="type: hull"
              visible="true"
            >
            </a-entity>
            <a-entity
              id="victorian-curtain-entity-two"
              gltf-model="#victorian-curtain"
              position="-9 16 -57"
              rotation="0 -180 0"
              scale="4 8 10"
              ammo-body="type: static"
              ammo-shape="type: hull"
              visible="true"
            >
            </a-entity>
          </a-entity>
          <!--  -->

          <!--Computer-->
          <a-entity id="computer" visible="true" hide-on-enter-ar>
            <a-entity
              id="computer-entitiy"
              gltf-model="#computer"
              position="0 15 -50"
              scale="1 1 1"
              rotation="0 0 0"
              visible="true"
              look-at-camera="enabled: false"
              animation="property: position; to: 0 15.5 -50; loop: true; dir: alternate; dur: 2000; easing: easeInOutQuad"
              proximity-circle="
                target: #computer-proximity-plane; 
                componentToChange: look-at-camera;
                compAttrToChange: enabled;
                compAttrNewBoolValue: true"
              on-event-deactivate-components="event: plug-grabbed; target: #plug-entity; components: proximity-circle, animation, look-at-camera"
              on-event-teleport="event: plug-grabbed; target: #plug-entity; position: 0 6.702 -40.813; rotation: 70.961 -176.460 -154.704"
            >
              <a-plane
                position="0 4.5 2.23"
                height="3"
                width="4.8"
                color="black"
                ammo-body="type: static"
                ammo-shape="type: box"
              ></a-plane>
              <a-plane
                src="#chatgptscreenshot"
                position="0 4.5 2.29"
                height="2.5"
                width="2.5"
                material="transparent: true; alphaTest: 0.5"
                animation="property: rotation; to: 0 0 -360; loop: true; dur: 5000; easing: easeInOutCubic"
                ammo-body="type: static"
                ammo-shape="type: box"
              >
              </a-plane>
              <a-entity
              id="computer-light"
              position="0 4.726 2.727"
              light="
                type: point;
                color: #ffffff;
                distance: 2;
                decay: 1;
                intensity: 3"
              >
              </a-entity>
            </a-entity>
            <a-circle
              id="computer-proximity-plane"
              position="0 0.03 -25"
              rotation="-90 0 0"
              radius="40"
              color="black"
              transparent="true"
              opacity="0"
              ammo-body="type: static"
              ammo-shape="type: box"
            ></a-circle>
          </a-entity>
        </a-entity>

        <!--Blackbox room-->
        <a-entity id="blackbox" hide-on-enter-ar>
          <a-entity
            id="blackbox-light"
            position="0 11.992 -121"
            rotation="-30 0 0"
            light="
              type: spot;
              color: #ffffff;
              distance: 50;
              angle: 20;
              decay: 1;
              intensity: 10;
              castShadow: true;
              target: generator-entity"
          >
          </a-entity>
          <a-entity
            id="generator-entity"
            gltf-model="#generator"
            position="-0.7 0 -144.3"
            ammo-body="type: static"
            ammo-shape="type: hull"
            visible="true"
          >
          </a-entity>
          <a-entity
            id="socket-entity"
            gltf-model="#socket"
            position="-0.056 0.873 -140.916"
            rotation="0 -90 0"
            visible="true"
          >
          </a-entity>
          <a-entity
            id="plug-entity"
            gltf-model="#antenna-plug"
            position="-0.056 1.028 -141.05"
            rotation="0 180 180"
            scale="0.27 0.27 0.27"
            visible="true"
            ammo-body="type: dynamic; gravity: 0 0 0"
            ammo-shape="type: hull"
            grabbable-custom="changeEntityPhysicsToDynamic: true; isPlug: true"
          >
          </a-entity
          ><!-- original-pos: -0.056 1.028 -141.05; home: -0.056 1.3 -0.8-->
          <a-entity
            id="diesel-generator-entity"
            gltf-model="#diesel-generator"
            position="-0.441 0 -141.585"
            rotation="0 -90 0"
            scale="2 2 2"
            visible="true"
          >
          </a-entity>
          <a-box
            id="dynamic-test"
            position="-0 3 -121.585"
            width="1"
            height="1"
            depth="1"
            ammo-body="type: dynamic"
            ammo-shape="type: box"
            grabbable-custom
          ></a-box>
          <a-circle
            id="room-proximity-plane"
            position="-0.441 0.09 -141.585"
            rotation="-90 0 0"
            radius="22"
            color="red"
            transparent="true"
            opacity="0"
          ></a-circle>
          <a-circle
            id="generator-proximity-plane"
            position="-0.441 0.1 -141.585"
            rotation="-90 0 0"
            radius="15"
            color="black"
            transparent="true"
            opacity="0"
          ></a-circle>

          <a-entity
            id="fence-entity"
            gltf-model="#fence"
            position="-2.85 0 -119.5"
            rotation="0 90 0"
            ammo-body="type: static"
            ammo-shape="type: mesh"
            visible="true"
          >
          </a-entity>
          <a-plane
            src="#chessfloor-diff"
            displacementMap="#chessfloor-disp"
            displacementScale="0.5"
            position="0 0.01 -134.5"
            scale="6 30 0"
            repeat="3 15"
            rotation="-90 0 0"
            ammo-body="type: static"
            ammo-shape="type: box"
          ></a-plane>

          <!--Info screens-->
          <!---->
          <a-entity
            spawn-text-planes="
            texts: Missing transparency, Racial Profiling, Water scarcity, Discrimination, Distortion, Dominance of large tech companies, Desinformation, Rising temperatures, Light polution, Lazyness, Unfair;
            proximityPlaneStopIdleFocus: #room-proximity-plane; 
            proximityPlaneStopSpiral: #generator-proximity-plane"
          ></a-entity
          >
        </a-entity>
      </a-entity>

      <!--AR Entities - Diese Objekte werden nur in AR angezeigt-->
      <a-entity id="ar-entities" hide-on-enter-vr>
        <!--AR Ambient Light-->
        <a-entity
          id="ar-ambient-light"
          light="type: ambient; color: #ffffff; intensity: 0.5"
          hide-on-enter-vr
        ></a-entity>

        <!--AR Ground Plane for Physics-->
        <a-plane
          id="ar-ground-plane"
          position="0 0 0"
          rotation="-90 0 0"
          width="20"
          height="20"
          visible="false"
          ammo-body="type: static"
          ammo-shape="type: box"
          hide-on-enter-vr
        ></a-plane>

        <!--AR Computer-->
        <a-entity
          id="ar-computer-entity"
          gltf-model="#computer"
          position="0 3 -20"
          scale="1 1 1"
          rotation="0 0 0"
          visible="true"
          hide-on-enter-vr
          look-at-camera="enabled: true; manualCamera: #head"
          animation="property: position; to: 0 3.5 -20; loop: true; dir: alternate; dur: 2000; easing: easeInOutQuad"
        >
          <a-plane
            position="0 4.5 2.23"
            height="3"
            width="4.8"
            color="black"
            ammo-body="type: static"
            ammo-shape="type: box"
          ></a-plane>
          <a-plane
            src="#chatgptscreenshot"
            position="0 4.5 2.29"
            height="2.5"
            width="2.5"
            material="transparent: true; alphaTest: 0.5"
            animation="property: rotation; to: 0 0 -360; loop: true; dur: 5000; easing: easeInOutCubic"
            ammo-body="type: static"
            ammo-shape="type: box"
          ></a-plane>
          <a-entity
            id="ar-computer-light"
            position="0 4.726 2.727"
            light="type: point; color: #ffffff; distance: 2; decay: 1; intensity: 3"
          ></a-entity>
        </a-entity>

        <!--AR Generator Area-->
        <a-entity
          id="ar-emptyGenerator-entity"
          position="0 0 2"
          rotation="0 180 0"
          hide-on-enter-vr
        >
          <a-entity
            id="ar-diesel-generator-entity"
            gltf-model="#diesel-generator"
            position="-0.441 0 -0.585"
            rotation="0 -90 0"
            scale="2 2 2"
            visible="true"
          ></a-entity>
          <a-entity
            id="ar-socket-entity"
            gltf-model="#socket"
            position="-0.056 0.873 0.047"
            rotation="0 -90 0"
            visible="true"
          ></a-entity>
        </a-entity>

        <!--AR Plug - direktes Kind der Scene fÃ¼r korrekte Physics-Synchronisation-->
        <a-entity
          id="ar-plug-entity"
          gltf-model="#antenna-plug"
          position="0.056 1.028 2.05"
          rotation="0 0 180"
          scale="0.27 0.27 0.27"
          visible="true"
          ammo-body="type: dynamic; gravity: 0 0 0"
          ammo-shape="type: hull"
          grabbable-custom="changeEntityPhysicsToDynamic: true; isPlug: true"
          hide-on-enter-vr
        ></a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>
